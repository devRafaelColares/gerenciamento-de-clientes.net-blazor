@page "/consulta"
@inject ClientesService ClientesService
@using Formulario.Core
@using MudBlazor

<PageTitle>Consulta de Clientes</PageTitle>

<MudPaper Class="pa-4">
    <MudText Typo="Typo.h6">Consulta de Clientes</MudText>
    <MudTable Items="_clientes">
        <HeaderContent>
            <MudTh>Código</MudTh>
            <MudTh>Nome</MudTh>
            <MudTh>Telefone</MudTh>
            <MudTh>Foto</MudTh>
            <MudTh>Sexo</MudTh>
            <MudTh>Data de Criação</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd DataLabel="Código">@context.Codigo</MudTd>
            <MudTd DataLabel="Nome">@context.Nome</MudTd>
            <MudTd DataLabel="Telefone">@context.Telefone</MudTd>
            <MudTd DataLabel="Foto">
                <MudAvatar Size="Size.Medium" ImgSrc="@context.Foto" />
            </MudTd>
            <MudTd DataLabel="Sexo">@context.Sexo</MudTd>
            <MudTd DataLabel="Data de Criação">@context.CreatedAt.ToString("dd/MM/yyyy HH:mm")</MudTd>
        </RowTemplate>
    </MudTable>
    <MudText Typo="Typo.subtitle2" Class="mt-4" Color="Color.Error" Hidden="@string.IsNullOrEmpty(_errorMessage)">
        @_errorMessage
    </MudText>
</MudPaper>

@code {
    private List<Cliente>? _clientes;
    private string _errorMessage = string.Empty;

    protected override async Task OnInitializedAsync()
    {
        var response = await ClientesService.GetClientes();

        if (response.IsSuccess && response.Data is not null)
        {
            _clientes = JsonSerializer.Deserialize<List<Cliente>>(response.Data);
        }
        else
        {
            _errorMessage = $"Erro: {response.ErrorMessage}";
        }
    }

    public class Cliente
    {
        public int Codigo { get; set; }
        public string Nome { get; set; } = string.Empty;
        public string Telefone { get; set; } = string.Empty;
        public string Foto { get; set; } = string.Empty;
        public string Sexo { get; set; } = string.Empty;
        public DateTime CreatedAt { get; set; }
    }
}

